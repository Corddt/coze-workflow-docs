# Coze 工作流节点文档

## 目录
- [工作流节点](#工作流节点)
  - [开始和结束节点](#开始和结束节点)
  - [大模型节点](#大模型节点)
  - [插件节点](#插件节点)
  - [工作流节点](#工作流节点-1)
  - [HTTP 请求节点](#http-请求节点)
  - [代码节点](#代码节点)
  - [选择器节点](#选择器节点)
  - [意图识别节点](#意图识别节点)
  - [循环节点](#循环节点)
  - [变量赋值节点](#变量赋值节点)
  - [变量聚合节点](#变量聚合节点)
  - [输入节点](#输入节点)
  - [输出节点](#输出节点)
  - [知识库写入节点](#知识库写入节点)
  - [知识库检索节点](#知识库检索节点)
  - [批处理节点](#批处理节点)
  - [SQL 自定义节点](#sql-自定义节点)
  - [新增数据节点](#新增数据节点)
  - [查询数据节点](#查询数据节点)
  - [更新数据节点](#更新数据节点)
  - [删除数据节点](#删除数据节点)
  - [问答节点](#问答节点)
  - [文本处理节点](#文本处理节点)
  - [长期记忆节点](#长期记忆节点)
  - [图像生成节点](#图像生成节点)
  - [画板节点](#画板节点)
  - [创建会话](#创建会话)
  - [清除上下文节点](#清除上下文节点)
  - [查询消息列表](#查询消息列表)
  - [设置定时触发器](#设置定时触发器)
  - [查询定时触发器节点](#查询定时触发器节点)
  - [删除定时触发](#删除定时触发)

## 开始和结束节点

开始节点用于开启触发一个工作流，而结束节点用于输出工作流的结果。

### 开始节点

开始节点是工作流的起始节点，用于设定启动工作流需要的输入信息。开始节点只有输入参数，没有输出等其他参数。开始节点中默认有一个输入参数 `BOT_USER_INPUT`，表示用户在本轮对话中输入的原始内容。你也可以按需添加其他参数。

#### 开始节点配置说明

1. **数据类型**
   - 开始节点支持配置 String、Number 等多种类型的输入参数
   - Object 类型的参数最多支持 3 层嵌套

2. **参数设置方式**
   - 支持直接添加参数并设置参数名称
   - 支持导入 JSON 数据，批量添加输入参数
   - 导入方式：点击导入图标 → 在展开面板中输入 JSON 数据 → 单击"同步JSON到节点"自动导入输入参数

3. **参数描述**
   - 用于帮助模型理解传入的参数含义
   - 当工作流绑定到智能体中使用时，模型会自动分析用户的 Query，将 Query 中表达的信息填入对应的参数中

4. **是否必选**
   - 可设置参数是否为必选项
   - 未指定必选参数时，无法开始执行工作流
   - 工作流绑定到智能体使用时，如果用户 Query 中缺少必选参数，则不会触发工作流

### 结束节点

结束节点是工作流的最终节点，用于返回工作流运行后的结果。结束节点支持两种返回方式：返回变量和返回文本。

#### 返回变量

- 以 JSON 格式输出所有返回参数
- 适用于工作流绑定卡片或作为子工作流的场景
- 当工作流直接绑定智能体时，对话中触发工作流后，大模型会自动总结 JSON 格式的内容，并以自然语言回复用户

#### 返回文本

返回文本模式下，工作流运行结束后，智能体中的模型将直接使用指定的内容回复对话。

配置说明：

| 设置 | 说明 |
|------|------|
| 输出变量 | 输出节点中输出的参数。为工作流绑定卡片时可以使用这些参数 |
| 回答内容 | 工作流的最终输出内容，不可设置为空。支持引用输出参数，引用方式为`{{变量名}}` | 

## 大模型节点

大模型节点是扣子提供的基础节点之一，你可以在该节点使用大语言模型处理任务。

### 节点说明

大模型节点可以调用大型语言模型，根据输入参数和提示词生成回复，通常用于执行文本生成任务，例如文案制作、文本总结、文章扩写等。

大模型节点依赖大语言模型的语言理解和生成能力，可以处理复杂的自然语言处理任务。你可以根据业务场景的需求选择不同的模型，并配置提示词来定义模型的人设和回复风格。为了更精准地控制模型生成的结果，你还可以在大模型节点中设置模型的参数，从而影响模型回复的文本长度、内容的多样性等。

### 配置大模型节点

#### 技能

支持为大模型节点配置技能，添加插件、工作流或知识库，扩展模型能力的边界。大模型节点运行时，会根据用户提示词自动调用插件、工作流或知识库，综合各类信息输入后输出回复。

配置技能后，大模型节点的能力更接近一个独立运行的智能体，可以自动进行意图识别，并判断调用技能的时机和方式，大幅度提高此节点的文本处理能力和文本生成效果，简化工作流的节点编排。例如用户需求是某地区的穿搭推荐，通常需要先通过插件节点查询某地天气，再由模型节点根据天气情况生成穿搭推荐，现在你可以直接在大模型节点添加查询天气的插件，大模型会自动调用插件，查询天气并推荐穿搭。

#### 模型

选择要使用的模型。此节点的输出内容质量很大程度上受模型能力的影响，建议根据实际业务场景选择模型。可选的模型范围取决于当前的账号类型：
- 基础版账号可以使用默认的几类模型，且存在对话数量限制
- 专业版账号可以使用火山引擎方舟平台的模型

你还可以单击配置图标，调整模型配置。

#### 输入

需要添加到提示词中的动态内容。系统提示词和用户提示词中支持引用输入参数，实现动态调整的效果。添加输入参数时需要设置：
- 参数名
- 变量值（支持设置为固定值或引用上游节点的输出参数）

在多轮对话场景中，你还可以开启智能体对话历史。执行此节点时，扣子会将智能体与当前用户的最近多条对话记录和提示词一起传递给大模型，以供大模型参考上下文语境，生成符合当前对话场景的回复。一问一答场景下通常无需开启此功能。

#### 系统提示词

模型的系统提示词，用于指定人设和回复风格。支持：
- 直接插入提示词库中的提示词模版
- 插入团队资源库下已创建的提示词
- 自行编写提示词

编写系统提示词时，可以引用：
- 输入参数中的变量：`{{variable}}`
- JSON的子变量：`{{变量名.子变量名}}`
- 数组中的某个元素：`{{变量名[数组索引]}}`
- 已添加到大模型节点的技能（插件工具、工作流、知识库）

#### 用户提示词

模型的用户提示词是用户在本轮对话中的输入，用于给模型下达最新的指令或问题。用户提示词同样可以引用输入参数中的变量。

#### 输出

指定此节点输出的内容格式与输出的参数。输出格式支持设置为：

| 格式 | 说明 |
|------|------|
| 文本 | 纯文本格式。此时大模型节点只有一个输出参数，参数值为模型回复的文本内容 |
| Markdown | Markdown 格式。此时大模型节点只有一个输出参数，参数值为模型回复的文本内容 |
| JSON | 标准 JSON 格式。可以直接导入JSON样例（系统会自动设置输出参数的结构），或直接添加多个参数并设置参数类型 |

参数的名称和描述有助于模型在参数中正确返回匹配的内容。当存在多个输出参数时，建议为输出参数指定有意义的名称，并设置描述信息。例如用于改写 Query 的模型节点，可以设置：
- 参数名：`new_query`，描述：改写后的 Query
- 参数名：`reason`，描述：改写原因

#### 异常设置

大模型节点支持异常忽略功能。开启此功能后：
- 如果试运行工作流时此节点运行失败，工作流不会中断，而是继续运行后续下游节点
- 如果下游节点引用了此节点的输出内容，则使用此节点预先配置的默认输出内容

### 常见问题

#### 大模型节点配置技能，和直接使用插件等技能节点有什么区别？

区别如下：
- **大模型节点配置技能**：
  - 模型会根据用户的 Query 自动判断调用技能的时机与方式
  - 自动判断执行技能时传递给技能的输入
  - 整体流程更加灵活，是模型 Function call 能力的直接体现

- **直接使用插件等技能节点**：
  - 工作流是开发者人工设计并配置的执行流程
  - 调用技能的时机和方式是固定的
  - 技能的输入是开发者的指定输入内容
  - 如果编排合理，相对于模型配置技能的场景整体效果更加稳定

#### 为什么模型输出和节点输出不一致，应如何处理？

参数的名称和描述有助于模型在参数中正确返回匹配的内容。当存在多个输出参数时，建议：
1. 为输出参数指定有意义的名称
2. 设置清晰的描述信息
3. 使用示例：
   - 用于改写 Query 的模型节点，设置输出参数为 `new_query`，描述为"改写后的 Query"
   - 另一个参数为 `reason`，描述为"改写原因" 

## 插件节点

插件节点用于在工作流中调用插件运行指定工具。

### 节点说明

插件是一系列工具的集合，每个工具都是一个可调用的 API。商店中的上架插件或已创建的个人或团队插件支持以节点形式被集成到工作流中，拓展智能体的能力边界。

### 输入与输出

- 插件节点的输入和输出结构取决于插件工具定义的输入输出结构，不支持自定义设置
- 在插件节点中你需要为必选的输入参数指定数据来源，支持设置为：
  - 固定值
  - 引用上游节点的输出参数

插件节点运行时，会调用工具处理输入参数，并根据工具定义输出处理后的数据。你可以在输出区域右上角单击"查看示例"，查看：
- 输出参数的详细说明
- 完整的输出示例

### 模拟集

试运行工作流时，插件节点的输出默认使用真实的输出数据，你也可以选择使用模拟集的数据。

模拟集是插件的模拟输出结果，每次试运行工作流时无需调用插件，直接使用数据集的数据作为后续节点的输入。支持：
- 自定义设置
- AI 自动生成模拟集

### 异常设置

插件节点支持忽略异常功能。开启此功能后：
- 如果试运行工作流时此节点运行失败，工作流不会中断，而是继续运行后续下游节点
- 如果下游节点引用了此节点的输出内容，则使用此节点预先配置的默认输出内容

## 工作流节点

扣子提供工作流节点，实现工作流嵌套工作流的效果。

### 节点说明

在一个工作流中，你可以将另一个工作流作为其中的一个步骤或节点，实现复杂任务的自动化。例如将常用的、标准化的任务处理流程封装为不同的子工作流，并在主工作流的不同分支内调用这些子工作流执行对应的操作。

工作流嵌套可实现复杂任务的模块化拆分和处理，使工作流编排逻辑更加灵活、清晰、更易于管理。

### 输入与输出

- 工作流节点的输入和输出结构取决于子工作流定义的输入输出结构，不支持自定义设置
- 在工作流节点中你需要为必选的输入参数指定数据来源，支持设置为：
  - 固定值
  - 引用上游节点的输出参数

### 批处理

工作流节点默认单次运行，对于输入信息只做一次处理。你也可以设置此节点使用 Batch processing 模式，按照配置多次运行。每次运行都会分配参数值，直到达到次数限制或者列表的最大长度。

工作流节点批处理模式通常用于批量执行一系列任务，支持同时处理多个输入，可显著提高海量数据的运行效率。例如子工作流的功能是文生图，单次执行工作流节点只能生成一张图片，批处理模式下可以批量生成多张图片。

批处理模式下，可以设置以下参数：
- **批处理次数上限**：批处理运行的次数上限，默认为 100 次
- **并行运行数量**：批处理的并发限制，即同时处理的任务数量，设置为 1 表示串行执行所有任务

### 异常设置

工作流节点支持忽略异常功能。开启此功能后：
- 如果试运行工作流时此节点运行失败，工作流不会中断，而是继续运行后续下游节点
- 如果下游节点引用了此节点的输出内容，则使用此节点预先配置的默认输出内容 

## HTTP 请求节点

HTTP 请求节点允许用户通过 HTTP 协议发送请求到外部服务，实现数据的获取、提交和交互。支持多种 HTTP 请求方法，并允许用户配置请求参数、请求头、鉴权信息、请求体等，以满足不同的数据交互需求。此外，HTTP 请求节点还提供了超时设置、重试机制，确保请求的可靠性和数据的正确处理。

### 节点作用

- **数据获取**：从外部服务获取数据，例如从 API 获取用户信息、天气数据等
- **数据提交**：向外部服务提交数据，例如提交表单数据等
- **数据更新**：更新外部服务中的数据，例如更新用户信息、修改订单状态等
- **数据删除**：删除外部服务中的数据，例如删除用户账户、删除订单等

### 节点配置

在使用 HTTP 请求节点实现数据获取、提交等功能时，通常需要配置 API、请求参数、请求头、鉴权、请求体等参数。为了简化这一配置过程，提高开发效率，HTTP 请求节点支持导入 cURL 功能，开发人员可以快速将 cURL 命令中的参数导入到 HTTP 请求节点。

#### 配置项说明

| 配置项 | 说明 |
|--------|------|
| API | 配置 API 请求地址和方法，支持以下请求方法：<br>• GET：用于请求从外部服务获取数据<br>• POST：用于向服务器提交数据<br>• HEAD：类似于 GET 请求，但只返回响应头<br>• PATCH：用于在请求-响应链上的每个节点获取传输路径<br>• PUT：用于向服务器上传资源<br>• DELETE：用于请求服务器删除指定的资源<br><br>配置API请求地址时，可以使用变量来动态指定参数，通过输入`{{`即可唤出并使用该变量 |
| 请求参数 | 请求参数是附加在 URL 后面的键值对，用于向服务器传递额外的信息。例如，在搜索请求中，可以通过请求参数传递搜索关键词 |
| 请求头 | 请求头包含客户端的信息，如 User-Agent、Accept 等。通过配置请求头，可以指定客户端的类型、接受的数据格式等信息 |
| 鉴权 | 支持 Bearer Token 和自定义鉴权：<br>• Bearer Token：输入 Token 值，通常用于 OAuth2 等认证方式<br>• 自定义鉴权：配置自定义的认证信息，包括：<br>  - Key：认证键<br>  - Value：认证值<br>  - Add To：选择将认证信息添加到请求头（Header）或查询参数（Query） |
| 请求体 | 请求体是 POST 请求中包含的数据，可以是表单数据、JSON 数据等。支持以下格式：<br>• form-data<br>• x-www-form-urlencoded<br>• raw text<br>• JSON |
| 超时设置 | 通过配置超时设置，可以避免长时间等待，提高系统的响应速度 |
| 重试次数 | 重试次数设置允许在请求失败时自动重试，提高请求的成功率 |
| 输出 | 输出变量包括响应体、状态码和响应头 |
| 异常忽略 | 支持异常忽略功能。开启此功能后：<br>• 如果试运行工作流时此节点运行失败，工作流不会中断<br>• 如果下游节点引用了此节点的输出内容，则使用此节点预先配置的默认输出内容 |

### 使用示例

以下示例展示如何通过 HTTP 请求节点调用扣子的查看智能体列表接口，获取指定空间发布到 Agent as API 渠道的智能体列表。

#### 节点配置示例

| 节点类型 | 配置说明 |
|----------|----------|
| 开始节点 | 工作流的起始节点，需要配置输入参数 `space_id`，用于指定要查看的空间 |
| HTTP 请求节点 | • API：`https://api.coze.cn/v1/space/published_bots_list`，方法为 GET<br>• 请求参数：定义参数 `space_id`，引用开始节点的输入参数<br>• 请求头：<br>  - Content-Type：`application/json`<br>  - Authorization：`Bearer $Access_Token`（个人访问令牌）<br>• 鉴权：本示例无需鉴权<br>• 请求体：none<br>• 其他配置保持默认 |
| 结束节点 | 选择返回变量模式，定义 `output` 参数，引用 HTTP 请求节点的输出参数 `body` |

### 常见问题

#### 如何解决 HTTP 请求超时问题？
可以通过配置超时设置来解决 HTTP 请求超时问题。合理设置超时时间，可以避免请求长时间等待。

#### 如何处理 HTTP 请求失败的情况？
可以通过配置重试次数设置来处理 HTTP 请求失败的情况。设置重试次数，可以提高请求的成功率。

#### 如何确保 HTTP 请求的安全性？
可以通过配置鉴权信息来确保 HTTP 请求的安全性，支持 Bearer Token 和自定义鉴权两种方式。

## 代码节点

代码节点支持通过编写代码来生成返回值。扣子支持在代码节点内使用 IDE 工具，通过 AI 自动生成代码或编写自定义代码逻辑，来处理输入参数并返回响应结果。

### 配置代码节点

| 配置 | 说明 |
|------|------|
| 输入 | 声明代码中需要使用的变量。添加输入参数时需要设置参数名和变量值，其中变量值支持设置为固定值或引用上游节点的输出参数。<br><br>**说明**：在代码中引用输入参数时，直接通过 `params['input']` 取值即可 |
| 代码 | 代码节点中需要执行的代码片段。你可以直接编写代码，也可以通过 AI 自动生成代码。<br>• 引用变量：直接使用输入参数中的变量，通过 `return` 一个对象来输出处理结果<br>• 函数限制：不支持编写多个函数。即使仅有一个输出值，也务必保持以对象的形式返回<br><br>支持 JavaScript 和 Python 两种语言 |
| 输出 | 代码运行成功后，输出的参数。你可以根据实际需求，在输出结构中只保留必要的参数。<br><br>**说明**：确保此处定义的参数名、类型与代码的 return 对象完全一致。以代码节点默认提供的代码为例，输出的参数与代码中定义的 return 对象完全一致 |

**注意**：节点执行超时限制为 60s。

### 开发语言

代码节点支持 JavaScript 和 Python 两种语言。

#### JavaScript

- 支持 V8 引擎的 11.3.244.8 版本（对应 Node.js 20.3.1 版本）
- 兼容 ECMAScript 2022 语法
- 代码 IDE 支持 TypeScript，提供静态语言的编码体验

内置的三方依赖库：
- dayjs（版本 1.8.36）
- lodash（版本 4.17.20）

JavaScript 运行时遵循 WinterCG 规范，支持的 Web API 包括：
- `atob()`、`btoa()`、`console`、`setTimeout()`、`clearTimeout()`、`structuredClone()`、`URL`、`URLSearchParams`、`AbortController`、`AbortSignal`、`TextEncoder`、`TextDecoder`
- WebStreams
- WebCrypto（算法仅支持 AES、HMAC、SHA）

JavaScript 示例代码：
```javascript
//only dayjs and lodash are allowed
import dayjs from 'dayjs';
import _ from 'lodash';

async function main({ params }: Args): Promise<Output> {
    // get input params by this way
    return {
      content: params.name
    };
}
```

#### Python

- 基于 Python 3.11.3 的标准库
- 不支持的模块：curses、dbm、ensurepip、fcntl、grp、idlelib、lib2to3、msvcrt、pwd、resource、syslog、termios、tkinter、turtle.py、turtledemo、venv、winreg、winsound、multiprocessing、threading、sockets、pty 和 tty

内置的第三方依赖库：
- requests_async
- numpy

**说明**：
- Python 运行时暂不支持 Http.client 方式的请求
- 不支持使用除 requests_async、numpy 以外的第三方依赖库
- 推荐使用异步版本的 `asyncio.sleep()` 替代 `time.sleep()`

Python 示例代码：
```python
import requests_async as requests

async def main(args: Args) -> Output:
    # you can get url by this way
    url = args.params['url']
    response = await requests.get(url)
    ret = {
      'code': response.status_code,
      'res': response.text,
    }
    return ret
```

### 使用代码 IDE 编写代码

扣子提供了网页版代码 IDE 环境，无需考虑代码部署等问题，只要关注代码逻辑即可。代码 IDE 还提供了 AI 插件，辅助你生成代码。

在节点内的代码区域单击"在IDE中编辑"可通过代码 IDE 编辑和调试代码。

常用操作说明：

| 操作 | 说明 |
|------|------|
| 使用 AI 生成代码 | 在 IDE 底部单击"尝试 AI"，并输入自然语言设定代码逻辑，AI 将自动生成代码。也可以选中代码片段，通过快捷键（macOS 为 Command + I、Windows 为 Ctrl + I）唤起 AI，并输入自然语言让 AI 帮助修改代码 |
| 补全代码 | 如果已经为代码节点配置好了输入参数，编辑时支持自动补全参数 |

### 试运行代码节点

试运行代码节点时，填写输入参数，并单击运行。平台会自动执行代码片段，并展示运行结果。运行结果包括：

- **原始输出**：代码执行的真实输出结果，包含代码中定义的所有输出参数。可以单击"Sync output to Node"，将原始输出的参数结构同步到代码节点
- **最终输出**：按照代码节点中指定的输出参数结构生成的输出结果

### 常见问题

#### 可以在代码节点中引入依赖包吗？
代码节点仅支持引用以下第三方依赖：
- JavaScript：dayjs、lodash
- Python：requests_async、numpy

#### 为什么代码节点输出了 tako_bot_userhistory？
如果在代码节点中通过函数遍历所有变量，可能会识别到系统变量（如 tako_bot_userhistory），导致运行报错。建议直接通过 `params['input']` 取值。

tako_bot_userhistory 为 String 格式，表示会话中的上下文消息。此系统变量即将下线，推荐使用查询消息列表节点。

#### 代码节点中如何使用 sleep 函数？
推荐使用 Python 标准库的 `asyncio.sleep` 函数，避免使用会阻塞工作流执行的 `time.sleep` 函数。

`asyncio.sleep` 函数用于异步编程中的非阻塞延迟（最长 1 分钟）。例如等待 30 秒的代码：
```python
import asyncio

async def main(args: Args) -> Output:
    await asyncio.sleep(30)
    return {"result": "done"}
```

#### 如何用 AI 生成代码？
常见的 AI 生成代码场景示例：

**通过正则匹配清洗数据**
- 用户提示词：通过正则匹配的方式，删除 input 中所有中文句号之后的空格
- AI 生成的代码：
```python
import re
async def main(args: Args) -> Output:
    input_str = args.params['input']
    # 使用正则表达式匹配
    result = re.sub(r'[\u4e00-\u9fff。]+(\s+)', '', input_str)    
    return {'key0': result}
``` 

## 选择器节点

选择器节点是一个 if-else 节点，用于设计工作流内的分支流程。当向该节点输入参数时，节点会判断是否符合"如果"区域的条件，符合则执行"如果"对应的工作流分支，否则执行"否则"对应的工作流分支。

每个分支条件支持添加多个判断条件（且/或），同时支持添加多个条件分支，可通过拖拽分支条件配置面板来设定分支条件的优先级。

## 意图识别节点

意图识别节点能够让智能体识别用户输入的意图，并将不同的意图流转至工作流不同的分支处理，提高用户体验，增强智能体的落地效果。

### 节点说明

意图识别（Intent Recognition）指的是让智能体理解用户通过自然语言表达的意图或目的。意图识别是智能助手的典型能力，例如用户在对话中输入"我想查看今天的 AI 新闻"，其中"查看新闻"为用户意图，也就是用户希望智能体执行的操作。

扣子工作流支持意图识别节点对用户意图进行归类，无需再通过大模型节点配合选择器节点实现意图识别，使工作流运行更加高效。

### 应用场景

- **客户服务**：识别用户问题的类型，并转交各类知识库处理，对于知识库中未匹配的问题，转交人工客服处理
- **医疗咨询**：对用户咨询的医学问题进行归类，非医学问题的咨询则拒绝回复
- **综合类智能体**：对于功能多样的智能体，可以先由意图识别节点对用户咨询进行初步分类，转交各个 Agent 分支处理

### 运行模式

意图识别节点支持两种运行模式：

#### 极速模式

以较快的速度对用户意图进行分类，适用于关注工作流运行效率的场景。

配置说明：

| 配置项 | 说明 |
|--------|------|
| 模型 | 默认使用扣子预设的极速模型，不支持修改模型 |
| 输入 | - 指定需要做意图识别判断的内容<br>- 输入参数默认为 query，可引用前置节点的输出参数，或输入指定内容<br>- 通常引用开始节点中的用户输入<br><br>**对话流支持**：<br>- 开启智能体对话历史：模型在识别意图时会参考上下文信息<br>- 设置会话轮数：设置带入模型上下文的对话历史轮数 |
| 意图匹配 | - 用户意图的分类选项，最多可设置 10 个意图<br>- 匹配到的意图会流转到对应的后续节点<br>- 未匹配意图流转到兜底策略<br>- 不支持通过高级设置指定模型分类的提示词 |
| 输出 | - 固定参数 `classificationId`：每个意图的 ID<br>- 从上到下依次排序，第一个意图的 ID 为 1<br>- 未命中任何意图时 ID 为 0 |

#### 完整模式

意图识别效果优先，适用于需要复杂逻辑判断的场景。

配置说明：

| 配置项 | 说明 |
|--------|------|
| 模型 | - 可选择执行意图识别的大模型<br>- 支持设置模型生成多样性等参数 |
| 输入 | 与极速模式相同 |
| 意图匹配 | - 最多可设置 50 个意图<br>- 其他特性与极速模式相同 |
| 高级设置 | - 可追加系统提示词<br>- 可提供各个分类的用户输入示例，使模型分类更精准 |
| 输出 | - `classificationId`：与极速模式相同<br>- `reason`：分类的原因和依据，由模型自动生成 |

### 使用示例

以客户服务类型的工作流为例：

#### 核心节点配置

1. **意图识别节点**
   - 将用户问题分为售前咨询或售后问题
   - 为每个分类提供典型示例作为分类依据

2. **知识库节点**
   - 售前问题 → 售前知识库
   - 售后问题 → 售后知识库
   - 可选：添加大模型节点处理未命中知识库的问题

3. **文本处理节点**
   - 作为兜底策略
   - 处理未命中任何分类的意图
   - 输出指导用户提交工单或联系人工客服的文案

### 常见问题

#### 如何提升意图分类准确性？

1. **调整分类**
   - 确保意图分类简洁明了
   - 避免模糊不清或容易混淆的语义
   - 确保分类之间有明确的区分度
   - 避免分类重叠（如"动物"和"动植物"）

2. **使用完整模式**
   - 选择效果更好的模型
   - 设置合适的提示词

3. **优化高级设置**
   - 提供具体的用户输入示例
   - 帮助模型更准确理解分类任务

4. **尝试切换模型**
   - 在其他优化措施效果不理想时
   - 尝试不同模型找到最适合的选择 

## 循环节点

循环节点用于重复执行一系列任务。

### 节点说明

循环是一种常见的控制机制，用于重复执行一系列任务，直到满足某个条件为止。扣子工作流提供循环节点，当需要重复执行一些操作，或循环处理一组数据时，可以使用循环节点实现。

例如，在长文总结场景中，通过循环节点依次生成各个段落，并流式输出每个段落的内容。

### 循环类型

循环节点支持三种运行模式：使用数组循环、指定循环次数和无限循环。

#### 使用数组循环

使用数组循环类似编程语言中的 for 语法结构，用于遍历一个已知的序列，对序列中的每个元素执行相同的步骤。

**典型应用场景**：
- **长文生成或长文总结**：输入每个段落的主题，通过循环节点依次生成各个段落，将完整的文章打包输出
- **问卷调查**：针对多个产品进行满意度、NPS 等问卷调查，根据每一轮问题的用户评分算出各个产品的 NPS 得分

**数组基础概念**：
- **item**：元素，即数组中的单个数据（可以是数字、字符、字符串等）
- **index**：索引，指数组中元素的位置（从 0 开始计数）
- **数组长度**：数组中元素的数量

例如，数组 `arrayOfNumbers = [10, 20, 30, 40, 50]` 中：
- `arrayOfNumbers[0]` 的 item 是 10，index 是 0
- `arrayOfNumbers[1]` 的 item 是 20，index 是 1
- 数组长度为 5

**配置说明**：
- 循环数组仅支持引用上游节点的输出，且必须为数组格式
- 循环次数取决于数组长度
- 如果引用多个数组，以最短的数组长度为准

**内置变量**：
- `item<String>`：当前循环到的数组元素
- `index<Integer>`：数组索引，index+1 为当前循环的轮次

#### 指定循环次数

指定循环次数模式通常用于批量、顺序处理数据的场景。

配置说明：
- 默认循环次数：10 次
- 支持范围：1~1000 次
- 可引用上游节点数值类型的输出参数
- 引用值超出范围时自动调整：>1000 设为 1000，<1 设为 1

#### 无限循环

无限循环类似编程语言中的 while 语法结构，需要通过终止循环节点停止循环。

**适用场景**：
- **批量处理数据**：例如通过自定义插件调用 API，出错时停止循环
- **增强搜索**：基于检索内容询问用户，循环执行多次检索直至符合要求
- **回合制游戏**：直到满足胜利条件或游戏结束条件才停止循环

**终止方式**：
- 需要配合终止循环节点使用
- 通常与条件判断节点关联
- 条件成立时流转到终止循环节点自动跳出循环

### 配置循环节点

**重要说明**：
- 多轮循环严格串行执行，不支持并发
- 不支持嵌套循环（但可以在循环节点中嵌套包含循环节点的工作流）
- 循环节点中不允许添加批处理节点

#### 设置中间变量

中间变量可作用于每一次循环，通常和循环体中的设置变量节点搭配使用。

配置示例（长文生成场景）：
1. **循环节点**：
   - 设置中间变量 `last_paragraph`
   - 初始值设为空格

2. **设置变量节点**：
   - 选择中间变量 `last_paragraph`
   - 设置值为大模型的输出参数 `output`

3. **大模型节点**：
   - 引用循环节点的内置变量 `item`
   - 引用循环变量
   - 在提示词中指定参考上个段落内容

**注意**：中间变量的数据类型必须和设置值的数据类型一致。

#### 设置循环体

循环体画布用于编排循环的主逻辑：
- 选中循环体才能添加/拖入新节点
- 无需设置开始/结束节点
- 按连接线箭头方向执行节点
- 设置变量节点、继续循环节点和停止循环节点只能在循环体中使用
- 不支持节点在循环体内外移动

#### 设置输出

支持两种输出方式：
- 循环体的执行结果集合
- 循环变量的取值

### 调试循环节点

调试结果显示：
- 循环节点多轮循环后的汇总输入输出
- 循环体中每个节点在每次循环的输入输出
- 变量赋值内容

### 常见问题

#### 如何将文本内容转为数组？

可以通过代码节点将文本转为数组，例如：

```python
async def main(args: Args) -> Output:
    params = args.params
    ret: Output = {
        "key0": params['input'].split("\n"),
    }
    return ret
```

#### 如何结束循环？

根据循环类型有不同的结束方式：
- **使用数组循环**：处理完所有元素后自动结束
- **指定循环次数**：达到指定次数后自动终止
- **无限循环**：需要通过终止循环节点停止

#### 如何在循环体中插入节点？

- 必须先选中循环体
- 只能添加新节点或拖入新节点
- 不支持节点在循环体内外移动 

## 变量赋值节点

变量赋值节点是工作流中用于修改和存储变量值的节点。

### 节点说明

通过变量赋值节点，将特定的值赋给变量，可以实现数据的动态更新和传递，使工作流能够根据实时数据做出相应的处理和决策。

**应用场景**：

1. **存储中间结果**
   - 将中间计算或处理结果存储到变量中供后续节点使用
   - 示例：智能医疗诊断应用中，将患者病历数据（关键症状、检查结果等）存储在 `patient_info` 变量中

2. **记录用户输入**
   - 存储用户交互过程中的输入信息
   - 示例：智能客服机器人提取用户问题关键词，存储在 `user_query` 变量中用于后续检索

3. **控制流程分支**
   - 设置控制流程分支的条件变量
   - 示例：个性化推荐系统中，将用户偏好分析结果存储在 `user_preference` 变量中用于决定推荐策略

### 配置说明

- **变量赋值**：
  - 在输入中添加需要赋值的参数
  - 字段名设置为需要赋值的变量名称
  - 变量值可以是固定值或引用上游节点的输出参数

**注意**：变量赋值节点可以为用户变量、应用变量赋值，但不能为系统变量赋值。

### 配置示例：猜谜游戏工作流

在此示例中，定义应用变量 `score`（默认值为 0），每猜对一个谜语加 1 分。

#### 节点配置

| 节点类型 | 配置说明 |
|----------|----------|
| 开始节点 | 保持默认参数 |
| 循环节点 | - 循环类型：指定循环次数<br>- 循环次数：5 |
| 大模型节点（出迷人） | - 系统提示词：设置出谜专家人设<br>- 输出参数：<br>  • `riddle`：谜语<br>  • `answer`：谜底 |
| 问答节点 | - 输入：引用 `riddle` 参数<br>- 提问内容：`{{riddle}}`<br>- 回答类型：直接回答<br>- 输出：`user_answer` |
| 大模型节点（谜语裁判） | - 输入参数：<br>  • `riddle`：谜语<br>  • `answer`：谜底<br>  • `user_answer`：用户回答<br>  • `score`：当前分数<br>- 输出参数：<br>  • `total_score`：游戏分数<br>  • `conclusion`：猜谜结果 |
| 变量赋值节点 | 将 `total_score` 赋值给 `score` 变量 |
| 输出节点 | - 输出变量：<br>  • `output`：结论<br>  • `score`：分数<br>- 输出内容：`{{output}}，你当前得分为：{{score}}` |
| 文本处理节点 | - 输入：`score` → `String1`<br>- 输出内容：`游戏结束！你本次总得分为{{String1}}，欢迎再次挑战哦~` |
| 结束节点 | - 模式：返回文本<br>- 输出变量：`output`<br>- 回答内容：`{{output}}` |

### 常见问题

#### 变量赋值节点能为系统变量赋值吗？
不能。系统变量仅可读不可写。

#### 变量赋值节点能读取变量值吗？
除了开始节点、输入节点、知识库写入节点外，其他所有节点都能读取变量值。

## 变量聚合节点

变量聚合节点能够将多路分支的输出变量整合为一个，方便下游节点统一配置。

### 节点说明

在多分支工作流中，变量聚合节点用于：
- 汇总所有分支的输出结果
- 读取多路分支中第一个不为空的值
- 简化数据流管理，避免处理未运行分支的空值

**适用场景**：
- 选择器或意图识别节点的多路分支
- 需要统一处理多个分支输出的情况

### 配置说明

#### 聚合策略

目前仅支持"返回每个分组中第一个非空的值"：
- 可拖动变量调整优先级
- 按顺序检查变量值，返回第一个非空值
- 示例：`output1`、`output2`、`output3` → `Group1`
  - 如果 `output1` 不为空，使用 `output1`
  - 否则检查 `output2`，以此类推

#### 聚合变量

- 支持多种数据类型：
  - 字符串（String）
  - 数字（Integer、Number）
  - 文件（File）
  - 对象（Object）
  - 数组（Array）
- 每个分组只能聚合相同数据类型的变量

#### 聚合分组

- 默认有一个 `Group1` 分组
- 可添加多个分组（`Group2`、`Group3` 等）
- 每个分组对应一个输出变量
- 分组内变量类型必须相同

#### 输出

- 输出变量名与分组名对应
- 数据类型与分组内变量类型相同
- 值由聚合策略决定

### 使用示例：家教类 AI 应用

#### 工作流说明

通过选择器判断学科类型，将问题分发到对应分支处理。

#### 节点配置

| 节点类型 | 配置说明 |
|----------|----------|
| 开始节点 | - `BOT_USER_INPUT`：用户问题<br>- `type`：学科类型 |
| 选择器节点 | 根据 `type` 分流到不同学科分支 |
| 大模型节点 | - 输入：`query`（用户问题）<br>- 输出：<br>  • `answer`：答案<br>  • `type`：学科类型 |
| 变量聚合节点 | - 分组1：聚合 `answer`<br>- 分组2：聚合 `type` |
| 结束节点 | - 输出变量：<br>  • `answer`：`Group1`<br>  • `type`：`Group2`<br>- 回答内容：答案内容 | 

## 输入节点

输入节点用于在工作流运行期间收集用户输入。

### 节点说明

在比较复杂的工作流场景中，某些节点的执行往往需要额外的用户输入。如果上游节点中没有获取到这些信息，你可以添加一个输入节点来主动收集信息。工作流执行到输入节点时会暂时中断，直到此节点收集到必要的用户输入。

**说明**：
- 仅扣子商店、豆包渠道或 OpenAPI 支持使用输入节点
- 如果需要通过输入节点上传文件，可以先将文件上传到第三方存储工具，获取一个公开可访问的 URL 地址，将此 URL 传入输入节点即可。目前仅试运行输入节点时可以直接上传本地文件

### 配置输入节点

输入节点中，只需设置输入参数即可。

| 配置 | 说明 |
|------|------|
| 变量名 | 输入参数的名称 |
| 变量类型 | 输入参数的数据类型，支持 String 等多种数据类型 |
| 描述 | 参数的描述信息 |
| 是否必选 | 参数是否必选。工作流在执行此节点时，收集到所有必选参数之后才会继续执行后续节点 |

你也可以直接导入 JSON 格式的数据结构来配置输入参数。

### 使用示例

以下示例展示如何通过输入节点获取城市名称，并调用模型节点查询该地区的热门景点。

#### 核心节点配置

| 节点类型 | 配置说明 |
|----------|----------|
| 输入节点 | 添加一个必选的输入参数，名为 city，即用户想去的城市 |
| 大模型节点 | 设置以下参数：<br>• 输入：添加一个输入参数，引用输入节点的参数 city<br>• 系统提示词：智能体的人设，按需设置<br>• 用户提示词：需要模型回答的问题，此处引用输入节点的参数 city<br>• 输出：维持默认设置即可 |

## 输出节点

输出节点用于在工作流执行过程中输出指定的消息内容。

**注意**：消息节点已更名为输出节点。

### 节点说明

通常情况下，工作流会在执行完毕后通过结束节点输出最终的执行结果。当工作流处理流程较长、运行时间较久时，开发者可以在工作流中添加输出节点，临时输出一段消息，避免用户等待时间过长、放弃对话。例如提示用户任务正在执行中，建议用户耐心等待。

输出节点支持流式和非流式两种模式，同时支持绑定卡片，展示丰富的交互效果，提升对话过程的用户体验。

### 配置输出节点

#### 输出变量

输出变量用于定义输出内容中可引用的变量，支持添加多个变量。每个变量均需要设置参数名和参数值，其中参数值可指定为某个固定值，或引用上游节点的输出变量。

输出变量也可以在输出节点绑定的卡片中使用。

#### 输出内容

在工作流运行过程中，智能体将直接使用这里指定的内容回复对话。你可以使用`{{变量名}}`的方式引用输出变量中定义的变量。

#### 流式输出

流式输出表示输出节点配置的输出内容会逐字地显示在对话中，类似于打字机的效果。流式输出适用于输出文本较长或需要工作流即时反馈的场景，呈现实时对话的交互效果。

**注意**：
- 输出节点只有在大模型节点之后才能开启流式响应
- 如果输出节点绑定了消息卡片，即使开启流式输出，输出的卡片也是非流式的
- 当在一个工作流中配置了多个输出节点并开启了流式返回时，输出节点的执行遵循工作流的执行顺序

### 使用示例

以好书解析智能体为例，通过大模型节点生成书籍的介绍，指定输出为两个段落，通过文本处理节点将两个段落拆开，一段通过输出节点输出，一段通过结束节点输出。

#### 核心节点配置

| 节点类型 | 配置说明 |
|----------|----------|
| 大模型节点 | 引用开始节点的变量，获取用户需要查询的书籍名称。用户提示词中需要指定输出格式，例如指定输出为两个段落 |
| 文本处理节点 | 使用字符串分隔模式，通过换行符将大模型节点的输出内容转为数组格式，每个段落是数组的一个元素 |
| 输出节点 | 引用文本处理节点的输出，注意这里只引用数组的第一个元素，也就是书籍简介的第一个段落 |
| 结束节点 | 引用文本处理节点的输出，这里只引用第二个段落即可 |

| 节点类型 | 配置说明 |
|----------|----------|
| 开始节点 | 保持默认参数 |
| 循环节点 | - 循环类型：指定循环次数<br>- 循环次数：5 |
| 大模型节点（出迷人） | - 系统提示词：设置出谜专家人设<br>- 输出参数：<br>  • `riddle`：谜语<br>  • `answer`：谜底 |
| 问答节点 | - 输入：引用 `riddle` 参数<br>- 提问内容：`{{riddle}}`<br>- 回答类型：直接回答<br>- 输出：`user_answer` |
| 大模型节点（谜语裁判） | - 输入参数：<br>  • `riddle`：谜语<br>  • `answer`：谜底<br>  • `user_answer`：用户回答<br>  • `score`：当前分数<br>- 输出参数：<br>  • `total_score`：游戏分数<br>  • `conclusion`：猜谜结果 |
| 变量赋值节点 | 将 `total_score` 赋值给 `score` 变量 |
| 输出节点 | - 输出变量：<br>  • `output`：结论<br>  • `score`：分数<br>- 输出内容：`{{output}}，你当前得分为：{{score}}` |
| 文本处理节点 | - 输入：`score` → `String1`<br>- 输出内容：`游戏结束！你本次总得分为{{String1}}，欢迎再次挑战哦~` |
| 结束节点 | - 模式：返回文本<br>- 输出变量：`output`<br>- 回答内容：`{{output}}` |

### 常见问题

#### 变量赋值节点能为系统变量赋值吗？
不能。系统变量仅可读不可写。

#### 变量赋值节点能读取变量值吗？
除了开始节点、输入节点、知识库写入节点外，其他所有节点都能读取变量值。

## 知识库写入节点

知识库写入节点用于将数据写入知识库。

### 节点说明

知识库写入节点支持将数据写入知识库，例如将用户信息、知识库数据等存储到知识库中。

### 配置说明

- **知识库类型**：
  - 支持多种知识库类型，例如：
    - 文本知识库
    - 结构化知识库
    - 图像知识库

- **数据来源**：
  - 支持从多种来源获取数据，例如：
    - 从外部服务获取数据
    - 从本地文件获取数据
    - 从数据库获取数据

- **数据格式**：
  - 支持多种数据格式，例如：
    - JSON 格式
    - Markdown 格式
    - 纯文本格式

### 配置知识库写入节点

#### 配置项说明

| 配置项 | 说明 |
|--------|------|
| 知识库类型 | 选择要写入的知识库类型 |
| 数据来源 | 选择数据来源，例如从外部服务获取数据 |
| 数据格式 | 选择数据格式，例如 JSON 格式 |
| 数据内容 | 输入要写入的知识库数据 |
| 知识库名称 | 输入知识库的名称 |

### 使用示例

以下示例展示如何通过知识库写入节点将用户信息写入知识库。

#### 核心节点配置

| 节点类型 | 配置说明 |
|----------|----------|
| 知识库写入节点 | 选择知识库类型为文本知识库，数据来源为外部服务，数据格式为 JSON 格式，输入要写入的知识库数据，知识库名称为用户信息 |

## 知识库检索节点

知识库检索节点用于从知识库中检索数据。

### 节点说明

知识库检索节点支持从知识库中检索数据，例如根据关键词检索相关知识库数据。

### 配置说明

- **知识库类型**：
  - 支持多种知识库类型，例如：
    - 文本知识库
    - 结构化知识库
    - 图像知识库

- **检索方式**：
  - 支持多种检索方式，例如：
    - 关键词检索
    - 全文检索
    - 结构化检索

- **输出格式**：
  - 支持多种输出格式，例如：
    - JSON 格式
    - Markdown 格式
    - 纯文本格式

### 配置知识库检索节点

#### 配置项说明

| 配置项 | 说明 |
|--------|------|
| 知识库类型 | 选择要检索的知识库类型 |
| 检索方式 | 选择检索方式，例如关键词检索 |
| 输出格式 | 选择输出格式，例如 JSON 格式 |
| 知识库名称 | 输入要检索的知识库名称 |
| 关键词 | 输入要检索的关键词 |

### 使用示例

以下示例展示如何通过知识库检索节点从知识库中检索相关数据。

#### 核心节点配置

| 节点类型 | 配置说明 |
|----------|----------|
| 知识库检索节点 | 选择知识库类型为文本知识库，检索方式为关键词检索，输出格式为 JSON 格式，知识库名称为用户信息，关键词为"用户信息" |

## 批处理节点

批处理节点用于批量处理数据。

### 节点说明

批处理节点支持批量处理数据，例如批量执行一系列任务、批量生成多张图片等。

### 配置说明

- **批处理次数上限**：
  - 设置批处理运行的次数上限，默认为 100 次
- **并行运行数量**：
  - 设置批处理的并发限制，即同时处理的任务数量，设置为 1 表示串行执行所有任务

### 使用示例

以下示例展示如何通过批处理节点批量处理数据。

#### 核心节点配置

| 节点类型 | 配置说明 |
|----------|----------|
| 批处理节点 | 设置批处理次数上限为 100 次，并行运行数量为 1 |

## SQL 自定义节点

**注意**：数据库节点已更名为 SQL 自定义节点。

### 节点说明

SQL 自定义节点可以连接智能体或应用中指定的数据库，对数据库进行新增、查询、编辑、删除等常见操作，实现动态的数据管理。SQL 自定义节点需要指定待操作的数据库表和对应的 SQL 语句，支持通过自然语言智能生成 SQL 语句。

**注意**：
- 开发调试阶段不会改动数据库原表，在调试区查看到的是测试数据，和数据库中的真实数据是隔离的。
- 在工作流中调试 SQL 自定义节点时，不能使用库数据表中的真实数据，需要先插入数据后再进行查、删、改等操作的测试。

扣子工作流还支持通过图形化方式进行数据的增、删、改、查操作，当你不熟悉 SQL 语句时，可使用以下节点操作数据库：
- 新增数据节点
- 查询数据节点
- 更新数据节点
- 删除数据节点

### 配置 SQL 自定义节点

#### 输入

节点的输入参数，即 SQL 语句中需要使用的参数，可以设置为固定值，也可以引用上游节点的输出参数。

#### 数据表

在数据表区域，你需要根据页面提示添加需要操作的数据表，每个 SQL 自定义节点仅支持操作一张数据表。

在调试期间，SQL 自定义节点显示和使用的是数据表的测试数据，而非数据库中的真实线上数据。单击数据表或单击查看数据，弹出数据表的详情页，可查看此数据表的测试数据。你可以手动添加或修改测试数据，也可以试运行 SQL 自定义节点，通过 SQL 语句插入或修改数据。

#### SQL

在 SQL 区域输入需要对数据表执行的 SQL 操作，兼容 SQL92 的常用语法。SQL 语句中可以引用 SQL 自定义节点输入参数中定义的变量，引用格式为 `{{变量名}}`。

**注意**：
- 每个 SQL 自定义节点中仅支持添加一条 SQL 语句。
- 不支持 Select* 语法、多表 Join 操作。
- 每次执行 SQL 自定义节点，最多返回 100 行数据。

你可以自行编写 SQL 语句，也可以根据页面提示由 AI 帮你生成一段 SQL 语句。单击自动生成，并在弹出的页面中使用自然语言描述要执行的操作，单击自动生成生成 SQL 语句，确认无误后单击使用。

#### 输出

SQL 自定义节点的输出参数是 SQL 执行后的输出内容，固定为以下两项：
- `outputList`：SQL 执行后数据表中的字段和数据。你可以按需新增子项，注意变量名需与 SQL 中定义的字段名一致、数据类型需要和数据表中定义的数据类型一致。
- `rowNum`：返回的行数或者受影响的行数。

### 常见问题

#### 为什么调试 SQL 自定义节点的结果和线上效果不一致？
调试工作流时，SQL 自定义节点使用的是临时的测试数据，线上执行工作流时使用的是数据库中的真实数据，所以统计查询的结果会有差异。

## 新增数据节点

新增数据节点用于向指定的数据库插入数据，对应 SQL 中的 INSERT 操作。

### 节点说明

在工作流中，你可以添加新增数据节点，以图形化方式配置数据库内数据的插入操作。此节点中需要指定待操作的数据库表和待插入的字段名称及字段值，每次执行此节点时自动插入一行数据。整个过程无需编写 SQL 语句，操作简单直观。

相比 SQL 自定义节点，新增数据节点中的操作极大降低了操作门槛，对于不熟悉 SQL 的用户，也能高效、轻松地操作数据库。

**注意**：
- 开发调试阶段不会改动数据库原表，在调试区查看到的是测试数据，和数据库中的真实数据是隔离的。
- 在工作流中调试新增数据节点时，不能使用库数据表中的真实数据，需要先插入测试数据后再进行查、删、改等操作的测试。

### 配置数据节点

#### 数据表

在数据表区域，你需要根据页面提示添加需要操作的数据表。每个新增数据节点仅支持操作一张数据表。

在调试期间，新增数据节点中显示和使用的是数据表的测试数据，而非数据库中的真实线上数据。单击数据表或单击查看数据，弹出数据表的详情页，可查看此数据表的测试数据。

#### 选择并设置字段

在选择并设置字段区域，系统会根据你所选数据表的结构，罗列出该表所包含的所有字段。你可以根据业务需求选择目标字段，为其配置字段值，支持设置为固定值，或引用上游节点的输出参数。

配置完成后，执行运行，数据表中将新增对应的测试数据。

### 输出

新增数据节点中的输出参数是执行数据新增操作后的输出内容，固定为以下两项：
- `outputList`：执行数据新增操作后数据表中的字段和数据。你可以按需新增子项，注意变量名需与定义的字段名一致、数据类型需要和数据表中定义的数据类型一致。
- `rowNum`：成功新增的数据行数。

### 示例

例如使用新增数据节点，向用户信息表 userinfo 中插入一条数据：
- companyname：co
- username：xiaoming
- tel：123

## 查询数据节点

查询数据节点用于从数据库中检索数据。

### 节点说明

查询数据节点支持从数据库中检索数据，例如根据关键词检索相关数据。

### 配置说明

- **数据表**：
  - 选择要检索数据的数据表
- **检索方式**：
  - 选择检索方式，例如关键词检索
- **输出格式**：
  - 选择输出格式，例如 JSON 格式

### 使用示例

以下示例展示如何通过查询数据节点从数据库中检索数据。

#### 核心节点配置

| 节点类型 | 配置说明 |
|----------|----------|
| 查询数据节点 | 选择要检索数据的数据表，选择检索方式为关键词检索，选择输出格式为 JSON 格式 |

## 更新数据节点

更新数据节点用于更新指定的数据库中数据，对应 SQL 中的 UPDATE 操作。

### 节点说明

在工作流中，你可以添加更新数据节点，以图形化方式配置数据库内数据的更新操作。此节点中需要指定待操作的数据库表、更新条件、待更新的字段名称及字段值，每次执行此节点时将更新所有符合条件的数据。整个过程无需编写 SQL 语句，操作简单直观。

相比 SQL 自定义节点，更新数据节点中的操作极大降低了操作门槛，对于不熟悉 SQL 的用户，也能高效、轻松地操作数据库。

**注意**：
- 开发调试阶段不会改动数据库原表，在调试区查看到的是测试数据，和数据库中的真实数据是隔离的。
- 在工作流中调试查询数据节点时，不能使用库数据表中的真实数据，需要先插入测试数据后再进行更新操作的测试。

### 配置更新数据节点

#### 数据表

在数据表区域，你需要根据页面提示添加待更新数据的数据表。每个更新数据节点仅支持操作一张数据表。

在调试期间，更新数据节点中显示和使用的是数据表的测试数据，而非数据库中的真实线上数据。单击数据表或单击查看数据，弹出数据表的详情页，可查看此数据表的测试数据。

#### 更新条件

在更新条件区域，你可以设置对应的筛选条件，以此来指定待更新数据的范围。

- 支持等于（=）、不等于（!= 或 <>）、模糊匹配（LIKE）、模糊不匹配（NOT LIKE）、包含（IN）、不包含（NOT IN）、为空（IS NULL）、不为空（IS NOT NULL）等运算符。
- 模糊查询时，后端会自动在字符串前后添加通配符 %，例如 %值%，无需手动配置通配符。
- 支持添加多个条件，多个条件之间的逻辑关系可设置为且、或关系。
- 至少添加一个更新条件。

#### 选择并设置字段

在选择并设置字段区域，系统会根据你所选数据表的结构，罗列出该表所包含的所有字段。你可以根据业务需求，选择待更新的字段，为其更新字段值。支持设置为固定值，或引用上游节点的输出参数。

### 输出

更新数据节点中的输出参数是执行数据更新操作后的输出内容，固定为以下两项：
- `outputList`：执行数据更新操作后数据表中的字段和数据。你可以按需新增子项，注意变量名需与定义的字段名一致、数据类型需要和数据表中定义的数据类型一致。
- `rowNum`：返回的行数或者受影响的行数。

### 示例

例如使用更新数据节点，在用户信息表 userinfo 中更新用户电话信息，即查询 username 字段等于 xiaoming 的数据，并将其对应的 tel 字段值更新为新值。

## 删除数据节点

删除数据节点用于删除指定的数据库中数据，对应 SQL 中的 DELETE 操作。

### 节点说明

在工作流中，你可以添加删除数据节点，以图形化方式配置数据库内数据的删除操作。此节点中需要指定待操作的数据库表和删除条件，每次执行此节点时将删除所有符合条件的数据。整个过程无需编写 SQL 语句，操作简单直观。

相比 SQL 自定义节点，删除数据节点中的操作极大降低了操作门槛，对于不熟悉 SQL 的用户，也能高效、轻松地操作数据库。

**注意**：
- 开发调试阶段不会改动数据库原表，在调试区查看到的是测试数据，和数据库中的真实数据是隔离的。
- 在工作流中调试查询数据节点时，不能使用库数据表中的真实数据，需要先插入测试数据后再进行删除操作的测试。

### 配置删除数据节点

#### 数据表

在数据表区域，你需要根据页面提示添加需要操作的数据表。每个删除数据节点仅支持操作一张数据表。

在调试期间，删除数据节点中显示和使用的是数据表的测试数据，而非数据库中的真实线上数据。单击数据表或单击查看数据，可查看此数据表的测试数据。

#### 删除条件

在删除条件区域，你可以设置对应的筛选条件，以此来指定待删除的数据，只有符合删除条件的数据才会被删除。

- 支持等于（=）、不等于（!= 或 <>）、模糊匹配（LIKE）、模糊不匹配（NOT LIKE）、包含（IN）、不包含（NOT IN）、为空（IS NULL）、不为空（IS NOT NULL）等运算符。
- 模糊查询时，后端会自动在字符串前后添加通配符 %，例如 %值%，无需手动配置通配符。
- 支持添加多个条件，多个条件之间的逻辑关系可设置为且、或关系。
- 至少添加一个删除条件。

### 输出

删除数据节点中的输出参数是执行数据删除操作后的输出内容，固定为以下两项：
- `outputList`：执行数据删除操作后数据表中的字段和数据。你可以按需新增子项，注意变量名需与定义的字段名一致、数据类型需要和数据表中定义的数据类型一致。
- `rowNum`：返回的行数或者受影响的行数。

### 示例

例如使用删除数据节点，删除用户信息表 userinfo 中所有 companyname 字段不等于 co 的数据。

## 问答节点

问答节点用于实现用户与智能体之间的对话交互。

### 节点说明

问答节点支持用户与智能体之间的对话交互，例如根据用户输入生成回复。

### 配置说明

- **输入**：
  - 设置用户输入的参数
- **输出**：
  - 设置智能体回复的参数

### 使用示例

以下示例展示如何通过问答节点实现用户与智能体之间的对话交互。

#### 核心节点配置

| 节点类型 | 配置说明 |
|----------|----------|
| 问答节点 | 设置用户输入的参数为 query，设置智能体回复的参数为 answer |

## 文本处理节点

文本处理节点用于将多种类型的输入数据进行字符串处理，适用于内容二次总结、文本拼接、文本转义等场景，例如对多轮对话中的关键字拼接为 prompt 后进行文生图。

文本处理节点的处理方式支持字符串拼接和字符串分隔。

### 处理方式

| 处理方式 | 说明 |
|----------|------|
| 字符串拼接 | 将输入中指定的内容根据一定顺序拼接为一个字符串，用于组合前置节点的关键信息，作为后置节点的输入。例如在分段总结场景中，把前置节点的总结结果拼接为完整段落，再输入给后置节点处理。<br><br>支持引用输入参数中的变量，引用格式包括 `{{变量名}}`、`{{变量名.子变量名}}`、`{{变量名[数组索引]}}`。直接引用数组类型的参数时，默认通过逗号连接数组中的每个元素，你也可以引用数组中指定位置的元素。 |
| 字符串分隔 | 将输入中的内容用指定分隔符拆分为字符串数组，便于后续节点对不同内容进行差异化处理。<br><br>你需要指定分隔符来拆分内容，支持自定义分隔符，例如设置多字符的分隔符，例如... |

### 使用示例

#### 字符串拼接示例

- **配置示例**：设置输入参数和拼接格式
- **输入示例**：白色
- **输出示例**："白色在英语中被称为White，在日语中被称为白い。"

#### 字符串分隔示例

- **配置示例**：设置分隔符为逗号
- **输入示例**：小明，18岁，A市人，喜欢看书、看电影，偶尔健身。
- **输出示例**：[ "小明", "18岁", "A市人", "喜欢看书、看电影", "偶尔健身" ]

## 长期记忆节点

长期记忆节点用于调用机器人的长期记忆功能，可以记住用户的个性化信息，适用于个性化推荐、用户画像等场景。该节点需要机器人开启长期记忆功能才能正常使用。

### 功能说明

长期记忆节点可以帮助机器人：
- 记住用户的个人偏好
- 存储历史交互信息
- 提供个性化的回复和推荐
- 构建用户画像

### 配置说明

- **记忆类型**：选择要使用的记忆类型
  - 个人偏好
  - 历史交互
  - 用户画像
  
- **记忆操作**：
  - 读取记忆
  - 写入记忆
  - 更新记忆
  
### 使用示例

#### 个性化推荐场景

- **输入**：用户ID和查询内容
- **处理**：读取该用户的历史偏好记录
- **输出**：基于用户偏好的个性化推荐结果

#### 注意事项

1. 使用前需确保机器人已开启长期记忆功能
2. 建议合理设置记忆的保存周期
3. 注意用户隐私数据的保护

## 图像生成节点

图像生成节点用于根据文本描述或参考图片生成图像，支持多种图像生成模型和参数配置，适用于创意设计、内容创作等场景。

### 功能特点

- 支持多种图像生成模型
- 可配置图像质量和生成参数
- 支持文本到图像的生成
- 支持图像到图像的变换
- 提供丰富的提示词配置选项

### 配置说明

#### 基础配置

- **模型选择**：
  - 选择要使用的图像生成模型
  - 不同模型有不同的特点和适用场景
  
- **图像质量**：
  - 配置生成图像的质量等级
  - 可选择不同的分辨率和清晰度
  
- **提示词设置**：
  - 正向提示词：描述想要生成的图像内容
  - 反向提示词：描述不想要出现的内容
  - 支持中英文提示词

#### 高级配置

- **采样方法**：选择图像生成的采样算法
- **生成步数**：设置生成过程的迭代次数
- **随机种子**：控制生成结果的随机性

### 使用示例

#### 文本到图像生成

- **输入示例**：
  ```
  正向提示词："一只可爱的白色猫咪，坐在窗台上，阳光照射"
  反向提示词："模糊、扭曲、低质量"
  ```
- **配置参数**：
  - 模型：默认模型
  - 图像质量：高清
  - 采样步数：30
  
- **输出**：生成符合描述的高质量图像

#### 注意事项

1. 提示词的质量直接影响生成效果
2. 建议使用详细且准确的描述
3. 注意遵守相关的使用规范和版权要求
4. 生成时间可能随配置参数变化

## 画板节点

画板节点是一个支持自定义绘制的图形创作节点。画板节点通常用于图文排版和设计场景，例如电商海报、营销 banner、社交媒体博文配图等。

### 节点说明

你可以在画板节点中插入各种元素，例如上传指定图片、添加文本、添加矩形等各种线性图形、画笔自由绘制等，还可以添加变量元素，引用上游节点的输出。除此之外，你还可以设置元素图层、画板尺寸、画板颜色、画板透明度等。

在画板编辑区域双击预览图即可编辑画板，你也可以在画板编辑右上角单击图标来进入编辑状态。

**注意**：
- 画板节点限时免费中。详细收费计划请关注后续官网通知。
- 每次执行工作流时，叠图和添加文字插件节点的并发限制为单节点 10 次/秒。其他官方图像插件和图像节点的并发限制为 4 次/秒。

### 变量元素

画板节点中添加的变量可以作为一个画板元素展示在画面中，这种画板元素被称为变量元素。

如果需要引用上游节点的输出参数，作为画板节点的元素之一，可以在画板节点的配置页面元素设置区域单击加号（+）来增加一个元素，元素值引用上游节点的输出参数。

添加变量元素后，此元素不会默认展示在画布中，你需要在画布手动添加这个元素。目前支持通过以下方式在画布中添加变量元素：

| 添加方式 | 操作说明 | 示例 |
|----------|----------|------|
| 直接插入变量元素 | 在画布中单击引用变量图标，添加一个变量元素。默认插入与变量类型相同的元素对象，即 String 类型对应文本对象，image类型对应图片对象。 | 例如根据指定输入文案生成小红书笔记配图。我们可以在开始节点中添加输出参数 title，并在画板节点中引用这个参数 title，title 参数的值会自动添加到画板节点中。 |
| 在固定元素中设置引用变量 | 如需为固定元素设置引用，选中文本对象或图片对象，并在配置框中选择要引用的变量即可。固定元素中，仅文本对象和图片对象可以引用变量，且均可引用 image 和 String 类型的变量。<br>• 如果文本对象引用了 image 变量，最终生成的图片中，本文框内会展示变量对应图片的 URL。<br>• 如果 String 变量的值是一个公开可访问的图片 URL，那么图片对象可以引用这个 String 变量，最终生成的图片中，自动将 URL 渲染为图片。 |

### 固定元素

固定元素指添加到画板中的非变量元素，包括本地上传的图片、固定文本、画板中绘制的线性图形、画笔自由绘制等。对于固定元素的常见操作如下：

| 操作 | 说明 | 示例 |
|------|------|------|
| 添加图片 | 在画板中单击对应图标，上传一张本地图片到画板节点中。添加图片后，可以设置填充样式和描边样式。 |
| 添加文字 | 在画板中单击对应图标，添加一段文本内容到画板节点中。支持添加单行文本或区块文本，其中区块文本指固定大小的文本框。添加文本框后，双击文本框可以设置文字内容，单击文本框可以调整文字的大小、位置等展示效果。 |
| 添加图形 | 在画板中单击对应图标，添加一个线性图形到画板节点中。添加图形后，可以设置填充样式和描边样式。 |
| 画笔模式 | 在画板中单击对应图标，进入画笔模式。在画笔模式下，你可以自由操控鼠标或触控板，在画板中自由绘制。如需删除画笔轨迹，可以单击画笔图标退出画笔模式，再按下键盘上的 Delete 键。 |

### 元素样式

添加变量元素和固定元素之后，可以随时调整元素的样式、展示效果、通过快捷键复制或删除元素。

| 操作 | 说明 | 示例 |
|------|------|------|
| 调整元素样式 | 选中变量元素，可以快速调整变量元素的位置、元素大小等。选中变量元素后，界面会浮现出用于编辑图形的工具栏，你还可以在浮现的工具栏中点击相应图标，调整变量元素的外观样式，例如调整字体大小、颜色、字体类型等。此外，你还可以在画板中修改变量元素，直接预览显示效果，例如编辑文字预览效果、更换图片预览效果。 |
| 调整元素位置 | 在画布中直接鼠标拖拽元素即可移动元素位置。移动时页面会显示坐标辅助线，帮助你判断元素之间的相对位置。选中多个元素之后，还可以批量设置对齐方式。 |
| 快捷键操作 | 画布中支持通过以下快捷键复制操作：<br>• Command/Ctrl+C：拷贝<br>• Command/Ctrl+V：粘贴<br>• Command/Ctrl+D：拷贝并粘贴<br>• Alt+鼠标拖拽：自定义坐标快速复制<br>• Backspace/Delete：删除 |
| 删除元素 | 支持快捷键（Backspace/Delete）删除变量元素在内的所有元素。 |

### 画板设置

画板节点的基础设置包括尺寸、颜色、透明度等画板设置、元素图层、预览比例等。

| 操作 | 说明 | 示例 |
|------|------|------|
| 调整画板设置 | 在画板中单击对应图标，调整画板设置。支持调整画板尺寸、颜色和透明度。 |
| 重置视图 | 调整预览比例后，单击重置视图图标，恢复到 100% 预览比例。 |
| 调整预览比例 | 在画板中单击加号或减号，调整预览比例。预览的最小比例为 100%。 |
| 调整元素图层 | 选中元素后，在画板中单击对应图标，将指定元素置底或置顶。适用于元素重叠展示的场景下调整元素所在图层，例如在某个图形上叠加文字。 |

### 输出

画板节点的输出参数固定为：
- `data`：Image 格式的图像，即排版后的最终图像。通常是一个公开可访问的 URL 链接。
- `msg`：节点执行状态，success 表示处理成功。

### 使用示例

例如通过画板节点搭建一个生成小红书配图的图像流。其中：
- 添加变量元素 mbti 和 title，引用开始节点的输入参数，作为画板中动态调整的 MBTI 部分、主题部分。
- 添加变量元素 image，引用开始节点的图片输入，作为画板中的配图。
- 最后为图片设置一个底色、调整尺寸即可。

## 创建会话

会话指的是用户与模型之间基于同一主题的一系列连续的对话交互，会话中存储用户输入的消息和模型回复的消息。创建会话节点用于在工作流或对话流中创建一个空的会话。

### 节点说明

对话流通过会话来存储用户和模型的对话消息。每个对话流都需要绑定一个会话作为开始节点的默认会话，执行对话流时产生的消息都会自动写入到这个会话中。创建会话节点用于在工作流或对话流中生成一个新的会话，新会话中默认没有任何消息记录，它被绑定对话流并运行一次后才会有消息接入。

在一些需要在运行过程中创建会话的场景，可以通过会话节点创建会话，再将新会话作为对话流的入参，运行对话流、写入消息。

**重要说明**：
- 会话类节点只能在应用中使用。智能体暂不支持包含创建会话、清除上下文等会话类节点的工作流或对话流。
- 创建会话节点创建出的是动态会话，试运行时会展示在应用会话列表的动态会话区域，是应用的草稿态临时数据，与线上数据隔离。

### 配置创建会话节点

#### 输入

创建会话节点的输入参数固定为 `conversationName`，必选，String 类型，表示新会话的名称。同一个应用中会话名称必须唯一。会话名称参数可以指定为一个固定值，或引用上游节点的输出参数。

#### 输出

创建会话节点的输出参数用于展示创建会话节点的执行结果。参数固定为：
- `isSuccess`：Boolean 类型，表示创建会话节点是否执行成功。
- `isExisted`：Boolean 类型，表示应用中是否已存在此名称的会话。
- `conversationId`：新会话的 ID。

输出示例：

1. 应用中没有同名的会话，创建新会话成功，返回会话 ID：
```
conversationId : 7444890359211262037
isSuccess : true
isExisted : false
```

2. 应用中已有同名的节点，所以未创建会话，此时返回原会话的 ID：
```
conversationId : 7444890359211262004
isSuccess : true
isExisted : true
```

### 试运行创建会话节点

对于资源库中的工作流或对话流，试运行创建会话节点时，需要关联应用，表示在指定的应用中创建会话。

调试完成后，可以在试运行按钮左侧单击配置按钮，在已存会话页面中查看刚创建出的新会话。试运行创建出的会话是草稿态的测试数据，和线上数据隔离，你也可以按需删除这些会话。

因为试运行时绑定了应用，已存会话页面会展示该应用中的所有会话。

## 清除上下文节点

清除上下文节点用于清除指定会话中存储的上下文消息。

### 节点说明

会话中的历史消息也被称为上下文，对大模型的性能和文本生成效果有重要影响。较长的上下文可以为模型提供更多的信息参考，生成与上下文语义匹配的文本片段，使模型生成更为连贯、逻辑性更强的内容。

多轮对话中启动新话题时，过时的上下文也会同样影响模型的生成效果，例如模型可能召回一些过时的知识或记忆。此时可以使用清除上下文节点，清除会话中已存储的上下文，成功清除后，对话流中的大模型节点会读到的对话历史为空，之后的对话不会收到之前历史消息的影响。

例如以下对话中，清除上下文后模型的回复会更加准确：
```
用户：最近看了几个恐怖电影。
模型：真是非常刺激和紧张的观影体验！你看了哪些恐怖电影？
用户：你有什么别的好电影推荐吗？
模型：当然！恐怖电影《闪灵》你感兴趣吗？
【清除上下文】
用户：你有什么别的好电影推荐吗？
模型：根据最新的搜索结果，这里有一些 2024 年备受期待和推荐的电影。
```

**重要说明**：
- 会话类节点只能在应用中使用。智能体暂不支持包含创建会话、清除上下文等会话类节点的工作流或对话流。
- 试运行清除上下文节点时，只能清除应用中测试数据的上下文，无法清除线上数据。
- 清除上下文只会清除模型可见的上下文，不会真正删除会话中存储的历史消息。所以清除上下文之后，仍旧可以通过查询消息列表节点查看完整的消息内容。

### 配置清除上下文节点

#### 输入

清除上下文节点的输入参数固定为 `conversationName`，必选，String 类型，表示待清除上下文的会话名称。会话名称参数可以指定为一个固定值，或引用上游节点的输出参数。

#### 输出

清除上下文节点的输出参数用于展示清除上下文节点的执行结果。参数固定为 `isSuccess`，Boolean 类型，表示此节点是否执行成功。

### 试运行清除上下文节点

对于资源库中的工作流或对话流，试运行清除上下文节点时，需要关联应用，表示清除指定应用中的指定会话上下文。

调试完成后，可以在试运行按钮左侧单击配置按钮，在已存会话页面中查看已清除上下文的会话。对话框中会展示"上下文已清除"的字样。

## 查询消息列表

查询消息列表节点用于查看指定会话中的所有历史消息。

### 节点说明

每个对话流都需要绑定一个会话作为开始节点的默认会话，执行对话流时产生的消息都会自动写入到这个会话中，包括用户输入的消息和对话流输出的消息。查询消息节点可以展示指定会话中已记录的所有历史消息，在工作流或对话流中添加这个节点并绑定一个列表组件，你可以在用户界面中实时展示对话消息列表。

**重要说明**：
- 会话类节点只能在应用中使用。智能体暂不支持包含创建会话、清除上下文等会话类节点的工作流或对话流。
- 试运行查询消息列表节点时，只能查看应用中测试数据，无法查看线上数据。
- 消息在服务端的保存时长为180天，期满后，消息将自动从会话的消息记录中删除。

### 配置查询消息列表节点

#### 输入

消息列表节点预置了多个输入参数，且不支持手动调整参数名称。

默认按时间倒序查看最近的 50 条消息，支持通过 limit 参数翻页。如果会话中消息较多，你可以先查看部分消息，获取消息列表中返回的 first_id、last_id，再通过 beforeId 或 afterId 从指定位置开始查看消息。

输入参数的详细说明如下：

| 参数 | 说明 |
|------|------|
| conversationName | 待查看消息列表的会话名称。必选，String 类型，可以指定为一个固定值，或引用上游节点的输出参数。 |
| limit | 返回的最大消息数量。必选，Integer 类型，默认为 50，取值范围为 1~50。可以指定为一个固定值，或引用上游节点的输出参数。 |
| beforeId | 查看指定位置之前的消息。必选，String 类型，可以指定为一个固定值，或引用上游节点的输出参数。传入空字符串，表示不指定位置。如需向前翻页，则指定为输出参数中的 first_id。 |
| afterId | 查看指定位置之后的消息。必选，String 类型，可以指定为一个固定值，或引用上游节点的输出参数。传入空字符串，表示不指定位置。如需向后翻页，则指定为输出参数中的 last_id。 |

#### 输出

创建会话节点的输出参数用于返回执行结果和消息列表。参数固定如下：

| 参数 | 类型 | 说明 |
|------|------|------|
| messageList | Array<Object> | 指定会话中的消息列表。 |
| messageList.messageId | String | Message ID，即消息的唯一标识。 |
| messageList.role | String | 发送这条消息的实体。取值：<br>user：代表该条消息内容是用户发送的。<br>assistant：代表该条消息内容是智能体发送的。 |
| messageList.content_type | String | 消息内容的类型，取值包括：<br>1：文本。<br>2：多模态内容，文件、图片、语音等。 |
| messageList.content | String | 消息的内容，支持纯文本、多模态等多种类型的内容。 |
| first_id | string | 返回的消息列表中，第一条消息的 Message ID。 |
| last_id | string | 返回的消息列表中，最后一条消息的 Message ID。 |
| has_more | bool | 是否已返回全部消息。<br>true：未返回全部消息，可再次调用此接口查看其他分页。<br>false：已返回全部消息。 |

### 试运行查询消息列表节点

对于资源库中的工作流或对话流，试运行查询消息列表节点时，需要关联应用，表示查看指定应用中的指定会话。

试运行此节点，可以在输出结果中查看消息列表的详细内容。

## 设置定时触发器

设置定时触发器节点用于在扣子应用中创建一个定时触发器，或修改已创建的定时触发器。

### 节点说明

和智能体一样，扣子应用也支持设置定时触发器，在指定的时间点触发定时器调用某个工作流。扣子应用的触发器分为预设触发器和用户触发器两种，前者是开发者编排应用时创建的触发器，对所有用户生效，后者是扣子应用的用户通过定时触发器节点创建的，仅对指定用户生效。

设置定时触发器用于用户主动设置触发器的场景，例如在一个英语学习的 AI 应用中，每个用户都可以创建自己的学习计划，A 用户可以要求每天 10 点学习 10 个单词，B 用户可以要求 12 点学习 5 个。

**说明**：设置定时触发器等触发器节点仅支持在扣子应用中创建或使用，包含触发器节点的工作流无法添加到智能体中。

### 设置节点参数

#### 输入

设置定时触发器节点预设多个参数，配置说明如下：

| 变量 | 说明 | 示例 |
|------|------|------|
| id | 触发器的 ID，是触发器在扣子平台中的唯一标识，由扣子平台自动创建，不支持手动创建或编辑。<br><br>**说明**：<br>• 创建触发器时，无需设置 id，系统会自动生成一个 id。<br>• 更新触发器配置时，需要输入 id，表示更新指定的触发器。 |
| 用户id | 使用触发器的扣子用户 ID，此触发器仅对该用户生效。扣子应用的系统变量 sys_uuid 可以用来标识用户，你可以使用变量节点获取系统变量 sys_uuid 的值，并赋值给设置定时触发器节点的用户id 参数。 |
| 名称 | 触发器的名称，用于标识触发器的用途。 |
| 时区 | 触发器的运行时区，建议根据 AI 应用的用户所在时区设置，确保定时任务在正确的时间启动。 |
| 触发时间 | 触发器的触发时间，触发时自动执行这个工作流。可以选择预设的时间选项（如每天 18 点），也可以使用 Cron 表达式来自定义复杂的时间。其中，Cron 表达式支持 AI 自动生成，也可以引用上游节点的输出。 |
| 绑定工作流 | 选择一个工作流，当触发器被激活时，扣子平台会自动运行该工作流。 |
| 参数 | 工作流开始节点设置的参数，其中必选参数应设置运行时的参数值。 |

#### 输出

设置定时触发器节点固定的输出参数为 `triggerId`，String 类型，表示已创建或更新的触发器 ID。

### 使用示例

为一个扣子应用添加每日个性化书单推荐的功能，可以根据不同用户的偏好推荐好书、为每个用户设置触发器，更新推荐书单，用户可以主动查看自己更新后的每日书单。

主要功能及对应流程如下：

| 功能模块 | 说明 | 工作流示例 |
|----------|------|------------|
| 更新推荐书单 | 通过变量节点获取用户 ID 和读书偏好，通过数据库节点查看过去已经推荐过的图书名称，大模型根据读书偏好和已推荐的书单，生成新的推荐书单，并写入数据库中。 |
| 创建或更新用户触发器 | 通过变量节点获取用户 ID，为用户设置个性化的触发器，绑定更新推荐书单的工作流，每天定时为每个用户更新书单。此工作流可以绑定用户界面中的某个按钮，用户单击按钮时触发工作流，创建触发器，每天定时更新书单。 |
| 查看每日书单 | 通过变量节点获取用户 ID，根据用户 ID 在数据库中查询今日推荐书单。这个工作流可以绑定用户界面中的某个按钮，用户单击按钮时触发工作流，展示今日推荐书单。 |
| 查看触发器列表 | 查看用户已创建的所有触发器列表。通过变量节点获取用户 ID，根据用户 ID 查询触发器列表。 |
| 删除书单触发器 | 不再需要获取每日书单时，可以删除书单触发器，每日书单不会定时更新。通过变量节点获取用户 ID，根据用户 ID 查询触发器列表、获取触发器 ID，根据用户 ID 和触发器 ID 删除指定用户的触发器。 |

## 查询定时触发器节点

查询定时触发器节点用于查看指定用户的触发器。

### 节点说明

和智能体一样，扣子应用也支持设置定时触发器，在指定的时间点触发定时器调用某个工作流。设置定时触发器用于用户主动设置触发器的场景，例如在一个英语学习的 AI 应用中，每个用户都可以创建自己的学习计划，A 用户可以要求每天 10 点学习 10 个单词，B 用户可以要求 12 点学习 5 个。

通过设置定时触发器节点创建触发器之后，可以通过查询定时触发器节点查看指定用户的触发器，支持查看某个触发器的详情，也可以查看触发器列表。

**说明**：设置定时触发器等触发器节点仅支持在扣子应用中创建或使用，包含触发器节点的工作流无法添加到智能体中。

### 设置节点参数

#### 输入

查询定时触发器节点预设多个参数，配置说明如下：

| 参数 | 说明 |
|------|------|
| id | 触发器的 ID，是触发器在扣子平台中的唯一标识，由扣子平台自动创建。可以通过设置定时触发器节点的输出参数中获取，也可以先不指定 id，查看此用户的所有触发器详情，详情中包括每一个触发器的 ID。<br><br>未指定 id 时，此节点返回指定用户的所有触发器。<br>指定 id 时，此节点仅返回指定触发器的详细信息。 |
| 用户id | 使用触发器的扣子用户 ID，此触发器仅对该用户生效。扣子应用的系统变量 sys_uuid 可以用来标识用户，你可以使用变量节点获取系统变量 sys_uuid 的值，并赋值给设置定时触发器节点的用户id 参数。 |

#### 输出

查询定时触发器节点固定的输出参数为 `outputList`，数组类型，表示触发器列表。其中包含每个触发器的 ID 等信息，结构体详细说明如下：

| 参数 | 说明 |
|------|------|
| triggerId | 已创建的触发器 ID。 |
| triggerName | 已创建的触发器名称。 |
| createTime | 触发器的创建时间。 |
| triggerTime | 触发器的触发时间，展示为 Cron 表达式格式。 |
| userId | 触发器对应的用户 ID。 |

### 使用示例

为一个扣子应用添加每日个性化书单推荐的功能，可以根据不同用户的偏好推荐好书、为每个用户设置触发器，更新推荐书单，用户可以主动查看自己更新后的每日书单。

主要功能及对应流程如下：

| 功能模块 | 说明 | 工作流示例 |
|----------|------|------------|
| 更新推荐书单 | 通过变量节点获取用户 ID 和读书偏好，通过数据库节点查看过去已经推荐过的图书名称，大模型根据读书偏好和已推荐的书单，生成新的推荐书单，并写入数据库中。 |
| 创建或更新用户触发器 | 通过变量节点获取用户 ID，为用户设置个性化的触发器，绑定更新推荐书单的工作流，每天定时为每个用户更新书单。此工作流可以绑定用户界面中的某个按钮，用户单击按钮时触发工作流，创建触发器，每天定时更新书单。 |
| 查看每日书单 | 通过变量节点获取用户 ID，根据用户 ID 在数据库中查询今日推荐书单。这个工作流可以绑定用户界面中的某个按钮，用户单击按钮时触发工作流，展示今日推荐书单。 |
| 查看触发器列表 | 查看用户已创建的所有触发器列表。通过变量节点获取用户 ID，根据用户 ID 查询触发器列表。 |
| 删除书单触发器 | 不再需要获取每日书单时，可以删除书单触发器，每日书单不会定时更新。通过变量节点获取用户 ID，根据用户 ID 查询触发器列表、获取触发器 ID，根据用户 ID 和触发器 ID 删除指定用户的触发器。 |

## 删除定时触发

删除定时触发器节点用于删除指定用户的触发器。

### 节点说明

和智能体一样，扣子应用也支持设置定时触发器，在指定的时间点触发定时器调用某个工作流。设置定时触发器用于用户主动设置触发器的场景，例如在一个英语学习的 AI 应用中，每个用户都可以创建自己的学习计划，A 用户可以要求每天 10 点学习 10 个单词，B 用户可以要求 12 点学习 5 个。

通过设置定时触发器节点创建触发器之后，可以通过删除定时触发器节点删除指定用户的触发器，支持删除某个触发器，也可以删除指定用户的所有触发器。

**说明**：设置定时触发器等触发器节点仅支持在扣子应用中创建或使用，包含触发器节点的工作流无法添加到智能体中。

### 设置节点参数

#### 输入

删除定时触发器节点预设多个参数，配置说明如下：

| 参数 | 说明 |
|------|------|
| id | 触发器的 ID，是触发器在扣子平台中的唯一标识，由扣子平台自动创建。可以通过设置定时触发器节点的输出参数中获取 id，也可以先不指定 id，查看此用户的所有触发器详情，详情中包括每一个触发器的 ID。<br><br>未指定 id 时，表示删除指定用户的所有触发器。<br>指定 id 时，表示删除指定触发器。 |
| 用户id | 使用触发器的扣子用户 ID。扣子应用的系统变量 sys_uuid 可以用来标识用户，你可以使用变量节点获取系统变量 sys_uuid 的值，并赋值给设置定时触发器节点的用户id 参数。 |

#### 输出

删除定时触发器节点固定的输出参数如下：

| 参数 | 说明 |
|------|------|
| success | 是否已成功删除触发器。 |
| numberOfDeletions | 删除的定时触发器数量。 |

### 使用示例

为一个扣子应用添加每日个性化书单推荐的功能，可以根据不同用户的偏好推荐好书、为每个用户设置触发器，更新推荐书单，用户可以主动查看自己更新后的每日书单。

主要功能及对应流程如下：

| 功能模块 | 说明 | 工作流示例 |
|----------|------|------------|
| 更新推荐书单 | 通过变量节点获取用户 ID 和读书偏好，通过数据库节点查看过去已经推荐过的图书名称，大模型根据读书偏好和已推荐的书单，生成新的推荐书单，并写入数据库中。 |
| 创建或更新用户触发器 | 通过变量节点获取用户 ID，为用户设置个性化的触发器，绑定更新推荐书单的工作流，每天定时为每个用户更新书单。此工作流可以绑定用户界面中的某个按钮，用户单击按钮时触发工作流，创建触发器，每天定时更新书单。 |
| 查看每日书单 | 通过变量节点获取用户 ID，根据用户 ID 在数据库中查询今日推荐书单。这个工作流可以绑定用户界面中的某个按钮，用户单击按钮时触发工作流，展示今日推荐书单。 |
| 查看触发器列表 | 查看用户已创建的所有触发器列表。通过变量节点获取用户 ID，根据用户 ID 查询触发器列表。 |
| 删除书单触发器 | 不再需要获取每日书单时，可以删除书单触发器，每日书单不会定时更新。通过变量节点获取用户 ID，根据用户 ID 查询触发器列表、获取触发器 ID，根据用户 ID 和触发器 ID 删除指定用户的触发器。 |